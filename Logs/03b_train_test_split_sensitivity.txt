===== TRAIN-TEST SPLIT SENSITIVITY ANALYSIS =====
Started at: 2025-05-13 08:06:43 

Loading modeling dataframe...
Loaded dataframe with 867 rows and 16 columns
Date range: 2018-10-01 to 2025-04-01 

===== DEFINING SPLIT RATIOS TO TEST =====

Testing train-test split ratios: 0.7, 0.75, 0.8, 0.85, 0.9 

===== DEFINING MODELS TO TEST =====

Testing models: arima, lasso, ridge, elastic_net 

===== DEFINING EVALUATION METRICS =====

Using evaluation metrics: rmse, mae, mape, r_squared 

===== IMPLEMENTING TRAIN-TEST SPLIT SENSITIVITY ANALYSIS =====

Running sensitivity analysis with 70% training data...
Training set size: 606 observations (69.9%)
Test set size: 261 observations (30.1%)
Training set date range: 2018-10-01 to 2023-02-01
Test set date range: 2023-02-01 to 2025-04-01
  Fitting arima model...
  Making predictions on test set...
  Predictions type: numeric, length: 261
  First few predictions: 31.5413223140496, 31.5826446280992, 31.6239669421488, 31.6652892561983, 31.7066115702479, 31.7479338842975
  Fitting lasso model...
  Making predictions on test set...
  Predictions type: matrix, length: 261
  First few predictions: 15.5818035785776, 15.5818035785776, 15.5818035785776, 15.5818035785776, 15.5818035785776, 15.5818035785776
  Fitting ridge model...
  Making predictions on test set...
  Predictions type: matrix, length: 261
  First few predictions: 16.340687401417, 16.340687401417, 16.340687401417, 16.340687401417, 16.340687401417, 16.340687401417
  Fitting elastic_net model...
  Making predictions on test set...
  Predictions type: matrix, length: 261
  First few predictions: 15.5877990014241, 15.5877990014241, 15.5877990014241, 15.5877990014241, 15.5877990014241, 15.5877990014241

Running sensitivity analysis with 75% training data...
Training set size: 650 observations (75.0%)
Test set size: 217 observations (25.0%)
Training set date range: 2018-10-01 to 2023-08-01
Test set date range: 2023-08-01 to 2025-04-01
  Fitting arima model...
  Making predictions on test set...
  Predictions type: numeric, length: 217
  First few predictions: 27.4, 27.4, 27.4, 27.4, 27.4, 27.4
  Fitting lasso model...
  Making predictions on test set...
  Predictions type: matrix, length: 217
  First few predictions: 23.2714849004874, 23.2714849004874, 23.2714849004874, 23.2714849004874, 23.2714849004874, 23.2714849004874
  Fitting ridge model...
  Making predictions on test set...
  Predictions type: matrix, length: 217
  First few predictions: 22.9059988558987, 22.9059988558987, 22.9059988558987, 22.9059988558987, 22.9059988558987, 22.9059988558987
  Fitting elastic_net model...
  Making predictions on test set...
  Predictions type: matrix, length: 217
  First few predictions: 23.2664637834399, 23.2664637834399, 23.2664637834399, 23.2664637834399, 23.2664637834399, 23.2664637834399

Running sensitivity analysis with 80% training data...
Training set size: 693 observations (79.9%)
Test set size: 174 observations (20.1%)
Training set date range: 2018-10-01 to 2023-11-01
Test set date range: 2023-11-01 to 2025-04-01
  Fitting arima model...
  Making predictions on test set...
  Predictions type: numeric, length: 174
  First few predictions: 29.2, 29.2, 29.2, 29.2, 29.2, 29.2
  Fitting lasso model...
  Making predictions on test set...
  Predictions type: matrix, length: 174
  First few predictions: 26.8698146743705, 26.8698146743705, 26.8698146743705, 26.8698146743705, 26.8698146743705, 26.8698146743705
  Fitting ridge model...
  Making predictions on test set...
  Predictions type: matrix, length: 174
  First few predictions: 25.8950219011553, 25.8950219011553, 25.8950219011553, 25.8950219011553, 25.8950219011553, 25.8950219011553
  Fitting elastic_net model...
  Making predictions on test set...
  Predictions type: matrix, length: 174
  First few predictions: 26.8399159593524, 26.8399159593524, 26.8399159593524, 26.8399159593524, 26.8399159593524, 26.8399159593524

Running sensitivity analysis with 85% training data...
Training set size: 736 observations (84.9%)
Test set size: 131 observations (15.1%)
Training set date range: 2018-10-01 to 2023-11-01
Test set date range: 2023-11-01 to 2025-04-01
  Fitting arima model...
  Making predictions on test set...
  Predictions type: numeric, length: 131
  First few predictions: 29.2, 29.2, 29.2, 29.2, 29.2, 29.2
  Fitting lasso model...
  Making predictions on test set...
  Predictions type: matrix, length: 131
  First few predictions: 27.7558588198585, 27.7558588198585, 27.7558588198585, 27.7558588198585, 27.7558588198585, 27.7558588198585
  Fitting ridge model...
  Making predictions on test set...
  Predictions type: matrix, length: 131
  First few predictions: 26.7516940075345, 26.7516940075345, 26.7516940075345, 26.7516940075345, 26.7516940075345, 26.7516940075345
  Fitting elastic_net model...
  Making predictions on test set...
  Predictions type: matrix, length: 131
  First few predictions: 27.7252953113966, 27.7252953113966, 27.7252953113966, 27.7252953113966, 27.7252953113966, 27.7252953113966

Running sensitivity analysis with 90% training data...
Training set size: 780 observations (90.0%)
Test set size: 87 observations (10.0%)
Training set date range: 2018-10-01 to 2024-02-01
Test set date range: 2024-02-01 to 2025-04-01
  Fitting arima model...
  Making predictions on test set...
  Predictions type: numeric, length: 87
  First few predictions: 23.1, 23.1, 23.1, 23.1, 23.1, 23.1
  Fitting lasso model...
  Making predictions on test set...
  Predictions type: matrix, length: 87
  First few predictions: 25.1472817249918, 25.1472817249918, 25.1472817249918, 25.1472817249918, 25.1472817249918, 24.0321400025712
  Fitting ridge model...
  Making predictions on test set...
  Predictions type: matrix, length: 87
  First few predictions: 24.5589305746714, 24.5589305746714, 24.5589305746714, 24.5589305746714, 24.5589305746714, 23.5010010213178
  Fitting elastic_net model...
  Making predictions on test set...
  Predictions type: matrix, length: 87
  First few predictions: 25.1356870651557, 25.1356870651557, 25.1356870651557, 25.1356870651557, 25.1356870651557, 24.0187346241192


===== ANALYZING RESULTS =====

Results by model and split ratio:
   split_ratio train_size test_size train_start_date train_end_date
1         0.70        606       261       2018-10-01     2023-02-01
2         0.70        606       261       2018-10-01     2023-02-01
3         0.70        606       261       2018-10-01     2023-02-01
4         0.70        606       261       2018-10-01     2023-02-01
5         0.75        650       217       2018-10-01     2023-08-01
6         0.75        650       217       2018-10-01     2023-08-01
7         0.75        650       217       2018-10-01     2023-08-01
8         0.75        650       217       2018-10-01     2023-08-01
9         0.80        693       174       2018-10-01     2023-11-01
10        0.80        693       174       2018-10-01     2023-11-01
11        0.80        693       174       2018-10-01     2023-11-01
12        0.80        693       174       2018-10-01     2023-11-01
13        0.85        736       131       2018-10-01     2023-11-01
14        0.85        736       131       2018-10-01     2023-11-01
15        0.85        736       131       2018-10-01     2023-11-01
16        0.85        736       131       2018-10-01     2023-11-01
17        0.90        780        87       2018-10-01     2024-02-01
18        0.90        780        87       2018-10-01     2024-02-01
19        0.90        780        87       2018-10-01     2024-02-01
20        0.90        780        87       2018-10-01     2024-02-01
   test_start_date test_end_date       model      rmse       mae      mape
1       2023-02-01    2025-04-01       arima 17.746110 13.380501 212.19589
2       2023-02-01    2025-04-01       lasso 13.582576 12.752798 104.05483
3       2023-02-01    2025-04-01       ridge 12.156655 11.385993  98.19937
4       2023-02-01    2025-04-01 elastic_net 13.572369 12.743106 104.00745
5       2023-08-01    2025-04-01       arima 10.637948  7.274194 148.25399
6       2023-08-01    2025-04-01       lasso  7.575417  6.479617 101.31032
7       2023-08-01    2025-04-01       ridge  7.715777  6.704946 101.52637
8       2023-08-01    2025-04-01 elastic_net  7.578181  6.483744 101.32414
9       2023-11-01    2025-04-01       arima 12.933653  8.694828 195.74164
10      2023-11-01    2025-04-01       lasso  7.366679  5.399651 118.14015
11      2023-11-01    2025-04-01       ridge  7.534414  5.781573 119.62532
12      2023-11-01    2025-04-01 elastic_net  7.373821  5.412448 118.23888
13      2023-11-01    2025-04-01       arima 14.905967 11.548855 259.99271
14      2023-11-01    2025-04-01       lasso  8.372754  6.338380 154.39852
15      2023-11-01    2025-04-01       ridge  8.491523  6.516274 156.07242
16      2023-11-01    2025-04-01 elastic_net  8.379944  6.347380 154.54179
17      2024-02-01    2025-04-01       arima 12.776519 10.778161 287.12645
18      2024-02-01    2025-04-01       lasso  9.937056  8.044250 228.33534
19      2024-02-01    2025-04-01       ridge 10.033637  8.056829 231.02991
20      2024-02-01    2025-04-01 elastic_net  9.946071  8.051070 228.57203
    r_squared
1  -2.6133645
2  -1.1167507
3  -0.6956400
4  -1.1135706
5  -0.2923216
6   0.3446580
7   0.3201483
8   0.3441798
9  -0.7973107
10  0.4169252
11  0.3900704
12  0.4157941
13 -1.4344326
14  0.2319065
15  0.2099609
16  0.2305868
17 -2.4679646
18 -1.0978047
19 -1.1387814
20 -1.1016129

Best split ratio for each model (based on RMSE):
# A tibble: 4 Ã— 6
# Groups:   model [4]
  model       split_ratio  rmse   mae  mape r_squared
  <chr>             <dbl> <dbl> <dbl> <dbl>     <dbl>
1 arima              0.75 10.6   7.27  148.    -0.292
2 elastic_net        0.8   7.37  5.41  118.     0.416
3 lasso              0.8   7.37  5.40  118.     0.417
4 ridge              0.8   7.53  5.78  120.     0.390


===== CREATING VISUALIZATIONS =====

Created RMSE by split ratio plot
Created R-squared by split ratio plot
Created metrics plot for arima model
Created metrics plot for lasso model
Created metrics plot for ridge model
Created metrics plot for elastic_net model

===== SAVING RESULTS =====

Saved detailed results to Processed_Data/split_sensitivity/all_results.csv
Saved best splits to Processed_Data/split_sensitivity/best_splits.csv

===== SUMMARY =====

Train-test split sensitivity analysis completed at: 2025-05-13 08:06:51 
Files created:
- Processed_Data/split_sensitivity/all_results.csv
- Processed_Data/split_sensitivity/best_splits.csv
- Processed_Data/split_sensitivity/predictions_arima_70.csv
- Processed_Data/split_sensitivity/predictions_arima_75.csv
- Processed_Data/split_sensitivity/predictions_arima_80.csv
- Processed_Data/split_sensitivity/predictions_arima_85.csv
- Processed_Data/split_sensitivity/predictions_arima_90.csv
- Processed_Data/split_sensitivity/predictions_lasso_70.csv
- Processed_Data/split_sensitivity/predictions_lasso_75.csv
- Processed_Data/split_sensitivity/predictions_lasso_80.csv
- Processed_Data/split_sensitivity/predictions_lasso_85.csv
- Processed_Data/split_sensitivity/predictions_lasso_90.csv
- Processed_Data/split_sensitivity/predictions_ridge_70.csv
- Processed_Data/split_sensitivity/predictions_ridge_75.csv
- Processed_Data/split_sensitivity/predictions_ridge_80.csv
- Processed_Data/split_sensitivity/predictions_ridge_85.csv
- Processed_Data/split_sensitivity/predictions_ridge_90.csv
- Processed_Data/split_sensitivity/predictions_elastic_net_70.csv
- Processed_Data/split_sensitivity/predictions_elastic_net_75.csv
- Processed_Data/split_sensitivity/predictions_elastic_net_80.csv
- Processed_Data/split_sensitivity/predictions_elastic_net_85.csv
- Processed_Data/split_sensitivity/predictions_elastic_net_90.csv

Plots created:
- Plots/split_sensitivity/rmse_by_split_ratio.png
- Plots/split_sensitivity/r_squared_by_split_ratio.png
- Plots/split_sensitivity/metrics_arima.png
- Plots/split_sensitivity/predictions_arima_70.png
- Plots/split_sensitivity/predictions_arima_75.png
- Plots/split_sensitivity/predictions_arima_80.png
- Plots/split_sensitivity/predictions_arima_85.png
- Plots/split_sensitivity/predictions_arima_90.png
- Plots/split_sensitivity/metrics_lasso.png
- Plots/split_sensitivity/predictions_lasso_70.png
- Plots/split_sensitivity/predictions_lasso_75.png
- Plots/split_sensitivity/predictions_lasso_80.png
- Plots/split_sensitivity/predictions_lasso_85.png
- Plots/split_sensitivity/predictions_lasso_90.png
- Plots/split_sensitivity/metrics_ridge.png
- Plots/split_sensitivity/predictions_ridge_70.png
- Plots/split_sensitivity/predictions_ridge_75.png
- Plots/split_sensitivity/predictions_ridge_80.png
- Plots/split_sensitivity/predictions_ridge_85.png
- Plots/split_sensitivity/predictions_ridge_90.png
- Plots/split_sensitivity/metrics_elastic_net.png
- Plots/split_sensitivity/predictions_elastic_net_70.png
- Plots/split_sensitivity/predictions_elastic_net_75.png
- Plots/split_sensitivity/predictions_elastic_net_80.png
- Plots/split_sensitivity/predictions_elastic_net_85.png
- Plots/split_sensitivity/predictions_elastic_net_90.png

Key findings:
- For arima model: 75% training data is optimal (RMSE: 10.638, R-squared: -0.292)
- For elastic_net model: 80% training data is optimal (RMSE: 7.374, R-squared: 0.416)
- For lasso model: 80% training data is optimal (RMSE: 7.367, R-squared: 0.417)
- For ridge model: 80% training data is optimal (RMSE: 7.534, R-squared: 0.390)

Next steps:
1. Use the optimal split ratio for each model in final modeling
2. Consider model-specific train-test splits for best performance

