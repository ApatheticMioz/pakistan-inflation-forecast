===== MODELING DATAFRAME PREPARATION =====

Started at: 2025-05-13 08:06:27 

Loading merged dataframe...
Loaded dataframe with 867 rows and 50 columns
Date range: 2018-10-01 to 2025-04-01 

CPI-related columns found: cpi, cpi_lag1, cpi_lag3, cpi_lag6, cpi_lag12, cpi_ma3, cpi_ma6, cpi_ma12 
Target variable 'cpi' found in the dataframe

===== INITIAL DATA EXPLORATION =====

No missing values found in the dataframe

===== OUTLIER DETECTION AND HANDLING =====

Created combined box and whisker plots for key variables
- Scaled version: Plots/model_prep/combined_boxplot.png
- Actual values: Plots/model_prep/faceted_boxplots.png

Variables with outliers detected:
  - oil_price_mom_pct : 79 outliers
  - oil_price_yoy_pct : 104 outliers
  - global_food_index_mom_pct : 79 outliers
  - global_food_index_yoy_pct : 26 outliers

Handling outliers by capping at 3 IQR from quartiles...
Outliers handled by capping

===== FEATURE SELECTION =====

Creating scatter plots to visualize relationships with target variable...
Warning: Duplicate column names detected in scatter matrix variables
Removed duplicate columns for scatter matrix
Created scatter plot matrix at Plots/model_prep/scatter_matrix.png
Created 15 individual scatter plots in Plots/model_prep/scatter_plots 

Calculating correlations with target variable (CPI)...
Top 20 variables by absolute correlation with CPI:
 1. cpi                                     :  1.000
 2. cpi_ma3                                 :  0.998
 3. cpi_lag1                                :  0.997
 4. cpi_ma6                                 :  0.995
 5. cpi_lag3                                :  0.990
 6. cpi_ma12                                :  0.989
 7. cpi_lag6                                :  0.980
 8. cpi_lag12                               :  0.961
 9. kibor_observation_value                 :  0.804
10. sugar_price_index                       :  0.750
11. meat_price_index                        :  0.517
12. oil_price_lag12                         :  0.489
13. oil_price_ma12                          :  0.483
14. oil_price_lag6                          :  0.477
15. oil_price_ma6                           :  0.473
16. oil_price_lag3                          :  0.470
17. oil_price_ma3                           :  0.468
18. oil_price_lag1                          :  0.467
19. oil_price                               :  0.465
20. global_food_index_lag12                 :  0.437

Correlation matrix plot saved to Plots/model_prep/correlation_matrix.png

Selecting features based on correlation threshold...
Selected 30 variables with absolute correlation > 0.3
Selected variables: cpi, cpi_ma3, cpi_lag1, cpi_ma6, cpi_lag3, cpi_ma12, cpi_lag6, cpi_lag12, kibor_observation_value, sugar_price_index, meat_price_index, oil_price_lag12, oil_price_ma12, oil_price_lag6, oil_price_ma6, oil_price_lag3, oil_price_ma3, oil_price_lag1, oil_price, global_food_index_lag12, global_food_index_lag6, global_food_index_ma12, global_food_index_yoy_pct, global_food_index_lag3, global_food_index_ma6, cereals_price_index, global_food_index_ma3, global_food_index_lag1, global_food_index, dairy_price_index 

Checking for multicollinearity among selected variables...
Found 190 pairs of highly correlated variables (r > 0.8):
  - cpi and cpi_ma3 : 0.998 
    Keeping cpi (corr with CPI: 1 ) over cpi_ma3 (corr with CPI: 0.998 )
  - cpi and cpi_lag1 : 0.997 
    Keeping cpi (corr with CPI: 1 ) over cpi_lag1 (corr with CPI: 0.997 )
  - cpi_ma3 and cpi_lag1 : 0.999 
  - cpi and cpi_ma6 : 0.995 
    Keeping cpi (corr with CPI: 1 ) over cpi_ma6 (corr with CPI: 0.995 )
  - cpi_ma3 and cpi_ma6 : 0.998 
  - cpi_lag1 and cpi_ma6 : 0.997 
  - cpi and cpi_lag3 : 0.99 
    Keeping cpi (corr with CPI: 1 ) over cpi_lag3 (corr with CPI: 0.99 )
  - cpi_ma3 and cpi_lag3 : 0.995 
  - cpi_lag1 and cpi_lag3 : 0.993 
  - cpi_ma6 and cpi_lag3 : 0.998 
  - cpi and cpi_ma12 : 0.989 
    Keeping cpi (corr with CPI: 1 ) over cpi_ma12 (corr with CPI: 0.989 )
  - cpi_ma3 and cpi_ma12 : 0.993 
  - cpi_lag1 and cpi_ma12 : 0.991 
  - cpi_ma6 and cpi_ma12 : 0.997 
  - cpi_lag3 and cpi_ma12 : 0.995 
  - cpi and cpi_lag6 : 0.98 
    Keeping cpi (corr with CPI: 1 ) over cpi_lag6 (corr with CPI: 0.98 )
  - cpi_ma3 and cpi_lag6 : 0.985 
  - cpi_lag1 and cpi_lag6 : 0.984 
  - cpi_ma6 and cpi_lag6 : 0.992 
  - cpi_lag3 and cpi_lag6 : 0.99 
  - cpi_ma12 and cpi_lag6 : 0.997 
  - cpi and cpi_lag12 : 0.961 
    Keeping cpi (corr with CPI: 1 ) over cpi_lag12 (corr with CPI: 0.961 )
  - cpi_ma3 and cpi_lag12 : 0.966 
  - cpi_lag1 and cpi_lag12 : 0.965 
  - cpi_ma6 and cpi_lag12 : 0.973 
  - cpi_lag3 and cpi_lag12 : 0.971 
  - cpi_ma12 and cpi_lag12 : 0.985 
  - cpi_lag6 and cpi_lag12 : 0.981 
  - cpi and kibor_observation_value : 0.804 
    Keeping cpi (corr with CPI: 1 ) over kibor_observation_value (corr with CPI: 0.804 )
  - cpi_ma3 and kibor_observation_value : 0.811 
  - cpi_lag1 and kibor_observation_value : 0.81 
  - cpi_ma6 and kibor_observation_value : 0.821 
  - cpi_lag3 and kibor_observation_value : 0.821 
  - cpi_ma12 and kibor_observation_value : 0.837 
  - cpi_lag6 and kibor_observation_value : 0.836 
  - cpi_lag12 and kibor_observation_value : 0.858 
  - meat_price_index and oil_price_lag12 : 0.817 
    Keeping meat_price_index (corr with CPI: 0.517 ) over oil_price_lag12 (corr with CPI: 0.489 )
  - meat_price_index and oil_price_ma12 : 0.83 
    Keeping meat_price_index (corr with CPI: 0.517 ) over oil_price_ma12 (corr with CPI: 0.483 )
  - oil_price_lag12 and oil_price_ma12 : 0.966 
  - meat_price_index and oil_price_lag6 : 0.818 
    Keeping meat_price_index (corr with CPI: 0.517 ) over oil_price_lag6 (corr with CPI: 0.477 )
  - oil_price_lag12 and oil_price_lag6 : 0.956 
  - oil_price_ma12 and oil_price_lag6 : 0.993 
  - meat_price_index and oil_price_ma6 : 0.824 
    Keeping meat_price_index (corr with CPI: 0.517 ) over oil_price_ma6 (corr with CPI: 0.473 )
  - oil_price_lag12 and oil_price_ma6 : 0.935 
  - oil_price_ma12 and oil_price_ma6 : 0.992 
  - oil_price_lag6 and oil_price_ma6 : 0.982 
  - meat_price_index and oil_price_lag3 : 0.819 
    Keeping meat_price_index (corr with CPI: 0.517 ) over oil_price_lag3 (corr with CPI: 0.47 )
  - oil_price_lag12 and oil_price_lag3 : 0.933 
  - oil_price_ma12 and oil_price_lag3 : 0.989 
  - oil_price_lag6 and oil_price_lag3 : 0.979 
  - oil_price_ma6 and oil_price_lag3 : 0.997 
  - meat_price_index and oil_price_ma3 : 0.822 
    Keeping meat_price_index (corr with CPI: 0.517 ) over oil_price_ma3 (corr with CPI: 0.468 )
  - oil_price_lag12 and oil_price_ma3 : 0.919 
  - oil_price_ma12 and oil_price_ma3 : 0.982 
  - oil_price_lag6 and oil_price_ma3 : 0.966 
  - oil_price_ma6 and oil_price_ma3 : 0.996 
  - oil_price_lag3 and oil_price_ma3 : 0.99 
  - meat_price_index and oil_price_lag1 : 0.82 
    Keeping meat_price_index (corr with CPI: 0.517 ) over oil_price_lag1 (corr with CPI: 0.467 )
  - oil_price_lag12 and oil_price_lag1 : 0.917 
  - oil_price_ma12 and oil_price_lag1 : 0.98 
  - oil_price_lag6 and oil_price_lag1 : 0.964 
  - oil_price_ma6 and oil_price_lag1 : 0.994 
  - oil_price_lag3 and oil_price_lag1 : 0.987 
  - oil_price_ma3 and oil_price_lag1 : 0.999 
  - meat_price_index and oil_price : 0.819 
    Keeping meat_price_index (corr with CPI: 0.517 ) over oil_price (corr with CPI: 0.465 )
  - oil_price_lag12 and oil_price : 0.909 
  - oil_price_ma12 and oil_price : 0.974 
  - oil_price_lag6 and oil_price : 0.956 
  - oil_price_ma6 and oil_price : 0.989 
  - oil_price_lag3 and oil_price : 0.979 
  - oil_price_ma3 and oil_price : 0.997 
  - oil_price_lag1 and oil_price : 0.995 
  - meat_price_index and global_food_index_lag12 : 0.886 
    Keeping meat_price_index (corr with CPI: 0.517 ) over global_food_index_lag12 (corr with CPI: 0.437 )
  - oil_price_lag12 and global_food_index_lag12 : 0.818 
  - oil_price_ma12 and global_food_index_lag12 : 0.831 
  - oil_price_lag6 and global_food_index_lag12 : 0.819 
  - oil_price_ma6 and global_food_index_lag12 : 0.825 
  - oil_price_lag3 and global_food_index_lag12 : 0.819 
  - oil_price_ma3 and global_food_index_lag12 : 0.822 
  - oil_price_lag1 and global_food_index_lag12 : 0.82 
  - oil_price and global_food_index_lag12 : 0.82 
  - meat_price_index and global_food_index_lag6 : 0.88 
    Keeping meat_price_index (corr with CPI: 0.517 ) over global_food_index_lag6 (corr with CPI: 0.404 )
  - oil_price_ma12 and global_food_index_lag6 : 0.827 
  - oil_price_lag6 and global_food_index_lag6 : 0.82 
  - oil_price_ma6 and global_food_index_lag6 : 0.826 
  - oil_price_lag3 and global_food_index_lag6 : 0.82 
  - oil_price_ma3 and global_food_index_lag6 : 0.823 
  - oil_price_lag1 and global_food_index_lag6 : 0.821 
  - oil_price and global_food_index_lag6 : 0.821 
  - global_food_index_lag12 and global_food_index_lag6 : 0.991 
  - meat_price_index and global_food_index_ma12 : 0.882 
    Keeping meat_price_index (corr with CPI: 0.517 ) over global_food_index_ma12 (corr with CPI: 0.403 )
  - oil_price_ma12 and global_food_index_ma12 : 0.827 
  - oil_price_lag6 and global_food_index_ma12 : 0.816 
  - oil_price_ma6 and global_food_index_ma12 : 0.827 
  - oil_price_lag3 and global_food_index_ma12 : 0.821 
  - oil_price_ma3 and global_food_index_ma12 : 0.825 
  - oil_price_lag1 and global_food_index_ma12 : 0.823 
  - oil_price and global_food_index_ma12 : 0.824 
  - global_food_index_lag12 and global_food_index_ma12 : 0.993 
  - global_food_index_lag6 and global_food_index_ma12 : 0.998 
  - meat_price_index and global_food_index_lag3 : 0.877 
    Keeping meat_price_index (corr with CPI: 0.517 ) over global_food_index_lag3 (corr with CPI: 0.388 )
  - oil_price_ma12 and global_food_index_lag3 : 0.821 
  - oil_price_lag6 and global_food_index_lag3 : 0.809 
  - oil_price_ma6 and global_food_index_lag3 : 0.825 
  - oil_price_lag3 and global_food_index_lag3 : 0.821 
  - oil_price_ma3 and global_food_index_lag3 : 0.824 
  - oil_price_lag1 and global_food_index_lag3 : 0.822 
  - oil_price and global_food_index_lag3 : 0.822 
  - global_food_index_lag12 and global_food_index_lag3 : 0.986 
  - global_food_index_lag6 and global_food_index_lag3 : 0.995 
  - global_food_index_ma12 and global_food_index_lag3 : 0.998 
  - meat_price_index and global_food_index_ma6 : 0.878 
    Keeping meat_price_index (corr with CPI: 0.517 ) over global_food_index_ma6 (corr with CPI: 0.386 )
  - oil_price_ma12 and global_food_index_ma6 : 0.82 
  - oil_price_lag6 and global_food_index_ma6 : 0.809 
  - oil_price_ma6 and global_food_index_ma6 : 0.824 
  - oil_price_lag3 and global_food_index_ma6 : 0.819 
  - oil_price_ma3 and global_food_index_ma6 : 0.824 
  - oil_price_lag1 and global_food_index_ma6 : 0.822 
  - oil_price and global_food_index_ma6 : 0.823 
  - global_food_index_lag12 and global_food_index_ma6 : 0.987 
  - global_food_index_lag6 and global_food_index_ma6 : 0.996 
  - global_food_index_ma12 and global_food_index_ma6 : 0.998 
  - global_food_index_lag3 and global_food_index_ma6 : 0.999 
  - global_food_index_lag12 and cereals_price_index : 0.948 
    Keeping global_food_index_lag12 (corr with CPI: 0.437 ) over cereals_price_index (corr with CPI: 0.378 )
  - global_food_index_lag6 and cereals_price_index : 0.954 
  - global_food_index_ma12 and cereals_price_index : 0.958 
  - global_food_index_lag3 and cereals_price_index : 0.957 
  - global_food_index_ma6 and cereals_price_index : 0.959 
  - meat_price_index and global_food_index_ma3 : 0.875 
    Keeping meat_price_index (corr with CPI: 0.517 ) over global_food_index_ma3 (corr with CPI: 0.378 )
  - oil_price_ma12 and global_food_index_ma3 : 0.816 
  - oil_price_lag6 and global_food_index_ma3 : 0.802 
  - oil_price_ma6 and global_food_index_ma3 : 0.821 
  - oil_price_lag3 and global_food_index_ma3 : 0.815 
  - oil_price_ma3 and global_food_index_ma3 : 0.823 
  - oil_price_lag1 and global_food_index_ma3 : 0.821 
  - oil_price and global_food_index_ma3 : 0.823 
  - global_food_index_lag12 and global_food_index_ma3 : 0.984 
  - global_food_index_lag6 and global_food_index_ma3 : 0.993 
  - global_food_index_ma12 and global_food_index_ma3 : 0.996 
  - global_food_index_lag3 and global_food_index_ma3 : 0.998 
  - global_food_index_ma6 and global_food_index_ma3 : 0.999 
  - cereals_price_index and global_food_index_ma3 : 0.96 
  - meat_price_index and global_food_index_lag1 : 0.875 
    Keeping meat_price_index (corr with CPI: 0.517 ) over global_food_index_lag1 (corr with CPI: 0.378 )
  - oil_price_ma12 and global_food_index_lag1 : 0.815 
  - oil_price_lag6 and global_food_index_lag1 : 0.802 
  - oil_price_ma6 and global_food_index_lag1 : 0.821 
  - oil_price_lag3 and global_food_index_lag1 : 0.814 
  - oil_price_ma3 and global_food_index_lag1 : 0.823 
  - oil_price_lag1 and global_food_index_lag1 : 0.822 
  - oil_price and global_food_index_lag1 : 0.823 
  - global_food_index_lag12 and global_food_index_lag1 : 0.983 
  - global_food_index_lag6 and global_food_index_lag1 : 0.992 
  - global_food_index_ma12 and global_food_index_lag1 : 0.996 
  - global_food_index_lag3 and global_food_index_lag1 : 0.997 
  - global_food_index_ma6 and global_food_index_lag1 : 0.999 
  - cereals_price_index and global_food_index_lag1 : 0.96 
  - global_food_index_ma3 and global_food_index_lag1 : 1 
  - meat_price_index and global_food_index : 0.874 
    Keeping meat_price_index (corr with CPI: 0.517 ) over global_food_index (corr with CPI: 0.372 )
  - oil_price_ma12 and global_food_index : 0.812 
  - oil_price_ma6 and global_food_index : 0.818 
  - oil_price_lag3 and global_food_index : 0.81 
  - oil_price_ma3 and global_food_index : 0.821 
  - oil_price_lag1 and global_food_index : 0.819 
  - oil_price and global_food_index : 0.822 
  - global_food_index_lag12 and global_food_index : 0.981 
  - global_food_index_lag6 and global_food_index : 0.991 
  - global_food_index_ma12 and global_food_index : 0.994 
  - global_food_index_lag3 and global_food_index : 0.995 
  - global_food_index_ma6 and global_food_index : 0.998 
  - cereals_price_index and global_food_index : 0.96 
  - global_food_index_ma3 and global_food_index : 0.999 
  - global_food_index_lag1 and global_food_index : 0.999 
  - meat_price_index and dairy_price_index : 0.856 
    Keeping meat_price_index (corr with CPI: 0.517 ) over dairy_price_index (corr with CPI: 0.33 )
  - oil_price_lag12 and dairy_price_index : 0.805 
  - oil_price_ma12 and dairy_price_index : 0.824 
  - oil_price_lag6 and dairy_price_index : 0.812 
  - oil_price_ma6 and dairy_price_index : 0.821 
  - oil_price_lag3 and dairy_price_index : 0.816 
  - oil_price_ma3 and dairy_price_index : 0.82 
  - oil_price_lag1 and dairy_price_index : 0.818 
  - oil_price and dairy_price_index : 0.818 
  - global_food_index_lag12 and dairy_price_index : 0.936 
  - global_food_index_lag6 and dairy_price_index : 0.934 
  - global_food_index_ma12 and dairy_price_index : 0.937 
  - global_food_index_lag3 and dairy_price_index : 0.933 
  - global_food_index_ma6 and dairy_price_index : 0.934 
  - cereals_price_index and dairy_price_index : 0.891 
  - global_food_index_ma3 and dairy_price_index : 0.933 
  - global_food_index_lag1 and dairy_price_index : 0.932 
  - global_food_index and dairy_price_index : 0.932 

Removing 26 variables due to multicollinearity:
cpi_ma3, cpi_lag1, cpi_ma6, cpi_lag3, cpi_ma12, cpi_lag6, cpi_lag12, kibor_observation_value, oil_price_lag12, oil_price_ma12, oil_price_lag6, oil_price_ma6, oil_price_lag3, oil_price_ma3, oil_price_lag1, oil_price, global_food_index_lag12, global_food_index_lag6, global_food_index_ma12, global_food_index_lag3, global_food_index_ma6, cereals_price_index, global_food_index_ma3, global_food_index_lag1, global_food_index, dairy_price_index 

Final selected variables: 4 
cpi, sugar_price_index, meat_price_index, global_food_index_yoy_pct 

===== FEATURE ENGINEERING AND TRANSFORMATION =====

Checking stationarity of target variable (CPI)...
ADF Test for CPI:
  Test statistic: 1.136427 
  p-value: 0.99 
  Interpretation: CPI is non-stationary 

Created differenced version of CPI (cpi_diff) for ARIMA modeling
ADF Test for differenced CPI:
  Test statistic: -9.288781 
  p-value: 0.01 
  Interpretation: Differenced CPI is stationary 

null device 
          1 
Saved plot comparing original and differenced CPI series

Normalizing numeric predictors...
Created standardized versions of 3 numeric predictors
Standardized columns: sugar_price_index_std, meat_price_index_std, global_food_index_yoy_pct_std

Saved preprocessing parameters to Processed_Data/preprocess_params.rds

===== CREATING TRAIN/TEST SPLIT =====

Total observations: 867 
Training set size: 693 observations
Test set size: 174 observations

Training set date range: 2018-10-01 to 2023-11-01 
Test set date range: 2023-11-01 to 2025-04-01 

===== CREATING TIME SERIES OBJECTS =====

Detected monthly data, setting time series frequency to 12
Created time series objects for ARIMA modeling:
  - Full dataset: cpi_ts
  - Training set: train_cpi_ts
  - Test set: test_cpi_ts

Saved time series objects to Processed_Data/ts_objects.rds

===== SAVING PREPARED DATASETS =====

Saved full modeling dataframe:
  - CSV: Processed_Data/model_df.csv
  - RDS: Processed_Data/model_df.rds
Saved training dataframe:
  - CSV: Processed_Data/train_df.csv
  - RDS: Processed_Data/train_df.rds
Saved test dataframe:
  - CSV: Processed_Data/test_df.csv
  - RDS: Processed_Data/test_df.rds

===== SUMMARY STATISTICS =====

      cpi              cpi         sugar_price_index meat_price_index
 Min.   : 0.300   Min.   : 0.300   Min.   : 63.2     Min.   : 91.2   
 1st Qu.: 8.979   1st Qu.: 8.979   1st Qu.: 87.1     1st Qu.:101.1   
 Median :12.282   Median :12.282   Median :116.4     Median :111.6   
 Mean   :16.421   Mean   :16.421   Mean   :113.6     Mean   :109.7   
 3rd Qu.:23.800   3rd Qu.:23.800   3rd Qu.:126.4     3rd Qu.:116.6   
 Max.   :38.000   Max.   :38.000   Max.   :162.7     Max.   :125.4   
 global_food_index_yoy_pct
 Min.   :-7.2446          
 1st Qu.:-0.8529          
 Median : 0.0000          
 Mean   : 0.4181          
 3rd Qu.: 1.2777          
 Max.   : 7.6694          

Saved summary statistics to Processed_Data/model_df_summary.txt

===== FINAL REPORT =====

Data preparation completed successfully!

Key statistics:
  - Original dataframe: 867 rows, 50 columns
  - Modeling dataframe: 867 rows, 16 columns
  - Selected features: 4 
  - Training set size: 693 observations
  - Test set size: 174 observations

Files created:
1. Processed_Data/model_df.csv - Full modeling dataframe
2. Processed_Data/model_df.rds - Full modeling dataframe (R object)
3. Processed_Data/train_df.csv - Training dataset
4. Processed_Data/train_df.rds - Training dataset (R object)
5. Processed_Data/test_df.csv - Test dataset
6. Processed_Data/test_df.rds - Test dataset (R object)
7. Processed_Data/ts_objects.rds - Time series objects for ARIMA modeling
8. Processed_Data/preprocess_params.rds - Preprocessing parameters
9. Processed_Data/model_df_summary.txt - Summary statistics
10. Various plots in Plots/model_prep/ directory

Next steps:
1. Proceed to 04_arima_modeling.R for ARIMA model implementation
2. Proceed to 05_regularization_modeling.R for Lasso, Ridge, and Elastic-Net Regression
3. Proceed to 06_model_evaluation.R for model comparison and final forecasting

Completed at: 2025-05-13 08:06:36 
